# 소설(Story) 스펙 문서

## 개요

- **도메인**: 소설 (AI Story Generation)
- **포함 페이지**: 소설 생성, 라이브러리, 소설 상세
- **관련 API**: /stories/_, /bookmarks/_
- **최종 업데이트**: 2025-12-10

---

## 페이지 1: AI 소설 생성 (GenerateStoryPage)

### 페이지 정보

- **경로**: `/stories/generate`
- **컴포넌트**: `GenerateStoryPage`, `StoryGenerationCard`
- **인증 필요**: 예 (JWT 필수)

### 기능 스펙

| 번호 | Domain         | User Story                          | UI 캡쳐 | 항목           | Spec.                                                                                                                                                                                                         | 참고사항             |
| ---- | -------------- | ----------------------------------- | ------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- |
| 1    | 페이지 헤더    | 사용자가 페이지에 접근한다          | -       | 헤더 영역      | • 제목: "AI 단편 소설 생성"<br>• 부제: "작가를 선택하고 태그를 골라 나만의 소설을 만들어보세요"                                                                                                               | 중앙 정렬            |
| 2    | 작가 로딩      | 페이지 로드 시 작가 목록을 가져온다 | -       | 전체           | • 로딩 중: 스피너 + "로딩 중..." 표시<br>• 화면 중앙 정렬                                                                                                                                                     | AbortController 사용 |
| 3    | 작가 로드 에러 | 작가 목록 로드 실패 시              | -       | 에러 영역      | • "작가 목록을 불러올 수 없습니다." 메시지<br>• "다시 시도" 버튼 표시<br>• 클릭 시 재요청                                                                                                                     | destructive 스타일   |
| 4    | 작가 없음      | 사용 가능한 작가가 없을 때          | -       | 안내 영역      | • "사용 가능한 작가가 없습니다." 메시지<br>• "데이터베이스에 작가를 추가해주세요." 안내                                                                                                                       | muted 배경           |
| 5    | 작가 선택      | 사용자가 작가를 선택한다            | -       | 드롭다운       | • 라벨: "작가 선택"<br>• placeholder: "작가를 선택하세요"<br>• 옵션: "{작가명} - {personality}"<br>• 생성 중 비활성화                                                                                         | select 요소          |
| 6    | 태그 선택      | 사용자가 태그를 선택한다            | -       | 태그 버튼 그룹 | • 라벨: "태그 선택 (최대 3개)"<br>• 사용 가능 태그: 로맨스, 느와르, 경쾌한, 어두운, 해피엔딩, 반전, 스릴러, 판타지<br>• 선택된 태그: primary 색상<br>• 3개 선택 시 나머지 비활성화<br>• 카운터: "선택됨: n/3" | 토글 방식            |
| 7    | 생성 버튼      | 소설 생성을 시작한다                | -       | 버튼 영역      | • 텍스트: "🚀 소설 생성하기" (대기 시) / "⏳ 생성 중..." (생성 시)<br>• 작가 미선택 또는 태그 미선택 시 비활성화<br>• 생성 중 비활성화                                                                        | flex-1 너비          |
| 8    | 취소 버튼      | 소설 생성을 취소한다                | -       | 버튼 영역      | • 텍스트: "❌ 취소"<br>• 생성 중에만 표시<br>• 클릭 시 SSE 연결 종료 및 상태 초기화                                                                                                                           | destructive 스타일   |
| 9    | 재시도 알림    | 생성 재시도 시                      | -       | 상태 영역      | • "🔄 재시도 중... (n/3)" 메시지<br>• 노란색 배경                                                                                                                                                             | 최대 3회 재시도      |
| 10   | 에러 표시      | 생성 실패 시                        | -       | 에러 영역      | • "❌ {에러메시지}" 표시<br>• 빨간색 배경                                                                                                                                                                     | hasError 상태        |
| 11   | 스트리밍 표시  | 소설이 생성되는 중                  | -       | 콘텐츠 영역    | • "생성 중..." 제목<br>• 글자수 카운터: "{n} 글자"<br>• 실시간 텍스트 표시<br>• 커서 깜빡임 애니메이션                                                                                                        | SSE 토큰 단위        |
| 12   | 완성 화면      | 소설 생성이 완료되면                | -       | 결과 영역      | • 소설 제목 (3xl 볼드)<br>• "📖 {n} 단어" / "✍️ {작가명}"<br>• 선택된 태그 배지<br>• 본문 전체 표시<br>• "새 소설 쓰기" 버튼                                                                                  | primary 테두리       |
| 13   | 새 소설 쓰기   | 다른 소설을 생성하려 한다           | -       | 버튼           | • "새 소설 쓰기" 클릭<br>• 상태 초기화<br>• 태그 선택 초기화<br>• 폼으로 돌아감                                                                                                                               | reset() 호출         |

### SSE 스트리밍 이벤트

| 이벤트 타입 | 데이터                                | 설명                                    |
| ----------- | ------------------------------------- | --------------------------------------- |
| `token`     | `{ token: string }`                   | 실시간 생성 토큰                        |
| `retry`     | `{ attempt: number, reason: string }` | 재시도 알림                             |
| `done`      | `StoryDto`                            | 완료 (id, title, content, wordCount 등) |
| `error`     | `{ message: string }`                 | 에러 발생                               |

### 사용 가능한 태그 목록

로맨스, 느와르, 경쾌한, 어두운, 해피엔딩, 반전, 스릴러, 판타지

---

## 페이지 2: 소설 라이브러리 (LibraryPage)

### 페이지 정보

- **경로**: `/library`
- **컴포넌트**: `LibraryPage`, `StoryFilters`, `StoryCard`, `StoryStats`, `Pagination`
- **인증 필요**: 예 (JWT 필수)

### 기능 스펙

| 번호 | Domain                   | User Story                 | UI 캡쳐 | 항목           | Spec.                                                                                                                                                                                           | 참고사항              |
| ---- | ------------------------ | -------------------------- | ------- | -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- |
| 1    | 페이지 헤더              | 사용자가 페이지에 접근한다 | -       | 헤더 영역      | • 제목: "내 소설 라이브러리"<br>• 부제: "생성된 소설을 검색하고 관리하세요"                                                                                                                     | -                     |
| 2    | 통계 카드                | 사용자 통계를 확인한다     | -       | 통계 영역      | • 총 소설 수 (totalStories)<br>• 총 글자 수 (totalWords)<br>• 총 읽기 시간 (totalReadTime)<br>• 평균 글자 수 (averageWordCount)<br>• 북마크 수 (bookmarkedCount)<br>• 인기 태그 Top 5 (topTags) | StoryStats 컴포넌트   |
| 3    | 검색 필터                | 소설을 검색한다            | -       | 필터 영역      | • 텍스트 검색 (search): 제목/내용에서 검색<br>• 디바운스 적용 (300ms 권장)                                                                                                                      | StoryFilters 컴포넌트 |
| 4    | 태그 필터                | 특정 태그로 필터링한다     | -       | 필터 영역      | • 태그 드롭다운<br>• 사용 가능한 태그 자동 추출 (현재 소설에서)<br>• 선택 시 해당 태그만 표시                                                                                                   | -                     |
| 5    | 북마크 필터              | 북마크된 소설만 본다       | -       | 필터 영역      | • "북마크만 보기" 옵션<br>• 토글 시 북마크된 소설만 표시                                                                                                                                        | bookmarked=true       |
| 6    | 정렬 옵션                | 정렬 방식을 변경한다       | -       | 필터 영역      | • 정렬 기준: 최신순(createdAt), 글자수(wordCount), 읽기시간(readTime)<br>• 정렬 순서: 오름차순(asc), 내림차순(desc)<br>• 기본값: 최신순 내림차순                                                | -                     |
| 7    | 소설 카드                | 소설 목록이 표시된다       | -       | 그리드 영역    | • 소설 제목<br>• 작가명 (있으면)<br>• 글자수, 읽기 시간<br>• 태그 배지 (최대 3개)<br>• 북마크 아이콘 (상태 반영)<br>• 클릭 시 상세 페이지 이동                                                  | 3열 그리드 (lg)       |
| 8    | 북마크 토글              | 소설을 북마크한다          | -       | 카드 내 아이콘 | • 클릭 시 북마크 토글<br>• **Optimistic Update**: 즉시 UI 반영<br>• 실패 시 자동 롤백<br>• 로딩 중 아이콘 비활성화                                                                              | useMutation           |
| 9    | 로딩 상태                | 데이터 로딩 중             | -       | 그리드 영역    | • 6개의 스켈레톤 카드 표시                                                                                                                                                                      | StoryCardSkeleton     |
| 10   | 에러 상태                | 데이터 로드 실패 시        | -       | 전체           | • "소설을 불러오는 중 오류가 발생했습니다." 메시지<br>• "다시 시도" 링크 (클릭 시 재요청)                                                                                                       | -                     |
| 11   | 빈 상태 - 검색 결과 없음 | 검색 결과가 없을 때        | -       | 전체           | • "검색 결과가 없습니다." 메시지                                                                                                                                                                | 필터 적용 시          |
| 12   | 빈 상태 - 소설 없음      | 소설이 없을 때             | -       | 전체           | • "아직 생성된 소설이 없습니다." 메시지<br>• "새로운 소설을 생성해보세요!" 안내                                                                                                                 | 필터 없을 때          |
| 13   | 페이지네이션             | 다른 페이지로 이동한다     | -       | 하단 영역      | • 현재 페이지 / 총 페이지 표시<br>• 이전/다음 버튼<br>• 페이지 변경 시 상단으로 스크롤                                                                                                          | Pagination 컴포넌트   |
| 14   | 결과 요약                | 표시 범위를 확인한다       | -       | 하단 텍스트    | • "총 N개의 소설 중 X-Y개 표시"                                                                                                                                                                 | -                     |

### 필터 기본값

```typescript
{
  page: 1,
  limit: 12,
  sort: 'createdAt',
  order: 'desc'
}
```

---

## 페이지 3: 소설 상세/읽기 (StoryDetailPage)

### 페이지 정보

- **경로**: `/stories/:id`
- **컴포넌트**: `StoryDetailPage`
- **인증 필요**: 예 (JWT 필수)

### 기능 스펙

| 번호 | Domain           | User Story             | UI 캡쳐 | 항목        | Spec.                                                                                                                                                   | 참고사항         |
| ---- | ---------------- | ---------------------- | ------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------- |
| 1    | 뒤로가기         | 라이브러리로 돌아간다  | -       | 상단 링크   | • "라이브러리로 돌아가기" 링크<br>• 왼쪽 화살표 아이콘<br>• 클릭 시 /library로 이동                                                                     | ChevronLeftIcon  |
| 2    | 소설 제목        | 소설 제목을 확인한다   | -       | 헤더 영역   | • 2xl 볼드 스타일<br>• flex-1로 공간 차지                                                                                                               | -                |
| 3    | 북마크 버튼      | 소설을 북마크한다      | -       | 헤더 우측   | • 아이콘 버튼 (ghost variant)<br>• 북마크 상태에 따라 채워진/빈 아이콘<br>• 클릭 시 토글<br>• aria-label: "북마크 추가" / "북마크 제거"                 | BookmarkIcon     |
| 4    | 삭제 버튼        | 소설을 삭제한다        | -       | 헤더 우측   | • 휴지통 아이콘 버튼<br>• 클릭 시 확인 다이얼로그<br>• "이 소설을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."<br>• 확인 시 삭제 후 /library로 이동 | destructive 색상 |
| 5    | 작가 정보        | 작가 정보를 확인한다   | -       | 메타 영역   | • 작가 프로필 이미지 (있으면, 24x24)<br>• "by {작가명}" 텍스트                                                                                          | 있는 경우만      |
| 6    | 메타 정보        | 소설 정보를 확인한다   | -       | 메타 영역   | • 글자수: "{n}자"<br>• 읽기 시간: "{n}분 읽기"<br>• 생성일: 한국어 날짜 형식<br>• 북마크 수 (0보다 클 때만)                                             | flex wrap        |
| 7    | 태그 표시        | 소설 태그를 확인한다   | -       | 태그 영역   | • Badge 컴포넌트 (secondary variant)<br>• 태그가 있을 때만 표시                                                                                         | -                |
| 8    | 본문 표시        | 소설 내용을 읽는다     | -       | 콘텐츠 영역 | • 단락별로 분리 표시 (줄바꿈 기준)<br>• prose prose-invert 스타일<br>• 적절한 행간 (leading-relaxed)                                                    | CardContent      |
| 9    | 하단 목록 버튼   | 목록으로 돌아간다      | -       | 하단 좌측   | • "목록으로" 버튼<br>• outline variant<br>• 왼쪽 화살표 아이콘                                                                                          | -                |
| 10   | 하단 북마크 버튼 | 북마크를 토글한다      | -       | 하단 우측   | • "북마크" / "북마크됨" 텍스트<br>• 상태에 따라 default/secondary variant<br>• 북마크 아이콘 포함                                                       | -                |
| 11   | 로딩 상태        | 소설 로딩 중           | -       | 전체        | • 애니메이션 pulse 스켈레톤<br>• 제목, 메타, 본문 영역 스켈레톤                                                                                         | -                |
| 12   | 에러/404 상태    | 소설을 찾을 수 없을 때 | -       | 전체        | • "소설을 불러올 수 없습니다." 메시지<br>• "라이브러리로 돌아가기" 버튼                                                                                 | -                |

---

## 북마크 기능 상세

### Optimistic Update 흐름

1. **사용자 액션**: 북마크 버튼 클릭
2. **즉시 UI 업데이트**: `isBookmarked` 토글
3. **API 요청**: `POST /bookmarks/:storyId/toggle`
4. **성공 시**:
   - 관련 쿼리 무효화 (`stories`, `storyStats`)
5. **실패 시**:
   - 자동 롤백 (이전 상태 복원)

### 북마크 API 엔드포인트

| Method | Endpoint                   | 설명                 |
| ------ | -------------------------- | -------------------- |
| POST   | /bookmarks                 | 북마크 생성 (멱등성) |
| POST   | /bookmarks/:storyId/toggle | 북마크 토글          |
| DELETE | /bookmarks/:storyId        | 북마크 삭제 (멱등성) |
| GET    | /bookmarks                 | 북마크된 소설 목록   |
| GET    | /bookmarks/:storyId/status | 북마크 상태 확인     |

---

## QA 테스트 시나리오

### 소설 생성 테스트

| #   | 시나리오                            | 기대 결과                        |
| --- | ----------------------------------- | -------------------------------- |
| 1   | 작가/태그 미선택 상태에서 생성 클릭 | 버튼 비활성화                    |
| 2   | 작가 선택 + 태그 1개 선택 후 생성   | 생성 시작, SSE 연결              |
| 3   | 태그 3개 선택 후 4번째 선택 시도    | 추가 불가 (비활성화)             |
| 4   | 생성 중 취소 버튼 클릭              | 생성 중단, 폼으로 복귀           |
| 5   | 생성 완료 후 "새 소설 쓰기" 클릭    | 상태 초기화, 폼 표시             |
| 6   | 네트워크 에러 발생 시               | 에러 메시지 표시                 |
| 7   | 재시도 로직 (콘텐츠 필터링)         | "재시도 중..." 메시지 (최대 3회) |

### 라이브러리 테스트

| #   | 시나리오                    | 기대 결과                     |
| --- | --------------------------- | ----------------------------- |
| 1   | 페이지 로드                 | 통계 + 소설 목록 표시         |
| 2   | 검색어 입력                 | 디바운스 후 필터링            |
| 3   | 태그 필터 선택              | 해당 태그 소설만 표시         |
| 4   | "북마크만 보기" 선택        | 북마크된 소설만 표시          |
| 5   | 정렬 변경 (글자수 오름차순) | 짧은 소설부터 표시            |
| 6   | 북마크 토글 클릭            | 즉시 UI 반영, API 호출        |
| 7   | 북마크 API 실패 시          | 자동 롤백                     |
| 8   | 페이지 변경                 | 해당 페이지 로드, 상단 스크롤 |
| 9   | 소설 카드 클릭              | /stories/:id로 이동           |

### 소설 상세 테스트

| #   | 시나리오              | 기대 결과                   |
| --- | --------------------- | --------------------------- |
| 1   | 페이지 로드           | 소설 정보 + 본문 표시       |
| 2   | 북마크 버튼 클릭      | 토글 후 UI 반영             |
| 3   | 삭제 버튼 클릭        | 확인 다이얼로그 표시        |
| 4   | 삭제 확인             | 삭제 후 /library로 이동     |
| 5   | 삭제 취소             | 상태 유지                   |
| 6   | "목록으로" 버튼 클릭  | /library로 이동             |
| 7   | 존재하지 않는 ID 접근 | 에러 화면 + 라이브러리 링크 |

---

## 성능 요구사항

| 기능                    | 목표 시간 |
| ----------------------- | --------- |
| 첫 토큰 응답 (스트리밍) | < 2초     |
| 전체 소설 생성          | < 30초    |
| 소설 목록 조회          | < 500ms   |
| 검색 쿼리               | < 1초     |
| 북마크 토글             | < 300ms   |
| 소설 상세 조회          | < 300ms   |
| 소설 삭제               | < 300ms   |

---

## 접근성 요구사항

- 모든 버튼에 aria-label 제공
- 키보드 내비게이션 지원
- 로딩/에러 상태 스크린리더 접근 가능
- 색상 대비 충족 (다크 테마)
- 포커스 표시 명확
